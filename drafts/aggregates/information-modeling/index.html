<!doctype html><html lang=ru-ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Алексей Жидков"><meta name=description content="https://azhidkov.pro/"><meta property="og:site_name" content="Алексей Жидков"><meta property="og:title" content="Черновик: Основные подходы к моделированию информации - объектная и реляционные модели информации - Алексей Жидков"><meta property="og:description" content="Обзор двух самых распространённых на сегодняшний день моделей информации"><meta property="og:type" content="website"><meta property="og:url" content="https://azhidkov.pro/drafts/aggregates/information-modeling/"><meta property="og:image" content="https://azhidkov.pro/"><meta name=twitter:card content="summary"><meta name=twitter:site content="https://azhidkov.pro/drafts/aggregates/information-modeling/"><meta name=twitter:image content="https://azhidkov.pro/"><base href=https://azhidkov.pro/drafts/aggregates/information-modeling/><title>Черновик: Основные подходы к моделированию информации - объектная и реляционные модели информации - Алексей Жидков</title><link rel=canonical href=https://azhidkov.pro/drafts/aggregates/information-modeling/><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700"><link rel=stylesheet href=/css/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css><link rel=stylesheet href=https://azhidkov.pro/css/custom.css><link rel=stylesheet href=https://azhidkov.pro/css/github.css><link rel=stylesheet href=https://azhidkov.pro/css/JetBrains-Mono.css><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=alternate href=https://azhidkov.pro/index.xml type=application/rss+xml title="Алексей Жидков"><link href=https://azhidkov.pro/index.xml rel=feed type=application/rss+xml title="Алексей Жидков"><meta name=generator content="Hugo 0.80.0"></head><body><main class=wrapper><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://azhidkov.pro/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://azhidkov.pro/favicon-16x16.png><link rel=manifest href=site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet type=text/css><nav class=navigation><section class=container style=height:100%><img src=https://azhidkov.pro/images/logo.svg class=logo>
<a class=navigation-title href=/>Алексей Жидков</a>
<input type=checkbox id=menu-control>
<label class="menu-mobile float-right" for=menu-control><span class="btn-mobile float-right">&#9776;</span><ul class=navigation-list><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/ergo-approach/landing>Эргономичный подход</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/effects-diagram/landing>Диаграмма Эффектов</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/posts>Блог</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/portfolio>Портфолио</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/>Контакты</a></li><li class=mobile-menu-lang-separator-full><hr></li></ul></label></section></nav><div class=content><section class="container page"><article><header><h1>Черновик: Основные подходы к моделированию информации - объектная и реляционные модели информации</h1></header><section class="doc-section level-1"><h2 id=_моделирование_информации>Моделирование информации</h2><section class="doc-section level-2"><h3 id=_введение>Введение</h3></section><section class="doc-section level-2"><h3 id=_сущности_связи_атрибуты_состояние_данные_объекты_объекты_значения_идентичность_и_все_все_все>Сущности, связи, атрибуты, состояние, данные, объекты, объекты-значения, идентичность и все-все-все</h3><section class="doc-section level-3"><h4 id=_универсальные_понятия>Универсальные понятия</h4><section class="doc-section level-4"><h5 id=_идентичность_хреновины>Идентичность хреновины</h5><section class="doc-section level-5"><h6 id=_на_базе_ида_места>На базе ИДа (места)</h6></section><section class="doc-section level-5"><h6 id=_на_базе_атрибутов>На базе атрибутов</h6></section></section><section class="doc-section level-4"><h5 id=_состояние>Состояние</h5></section><section class="doc-section level-4"><h5 id=_сущность>Сущность</h5></section><section class="doc-section level-4"><h5 id=_значение>Значение</h5></section><section class="doc-section level-4"><h5 id=_изменяемостьнеизменяемость>Изменяемость/неизменяемость</h5></section></section><section class="doc-section level-3"><h4 id=_абстрактная_модель>Абстрактная модель</h4><section class="doc-section level-4"><h5 id=_сущность_2>Сущность</h5></section><section class="doc-section level-4"><h5 id=_атрибут>Атрибут</h5></section><section class="doc-section level-4"><h5 id=_значениетипдомен>??? значение/тип/домен</h5></section><section class="doc-section level-4"><h5 id=_связь>Связь</h5></section></section><section class="doc-section level-3"><h4 id=_модель_информации_на_базе_записей>Модель информации на базе записей</h4></section><section class="doc-section level-3"><h4 id=_er_модель>ER-модель</h4></section><section class="doc-section level-3"><h4 id=_реляционная_модель>Реляционная модель</h4></section><section class="doc-section level-3"><h4 id=_ххх_модель_на_базе_структур_данных>ХХХ-модель на базе структур (данных)</h4><section class="doc-section level-4"><h5 id=_поля_атрибуты>Поля (атрибуты)</h5></section></section><section class="doc-section level-3"><h4 id=_ууу_модель_на_базе_указателейобъектов>УУУ-модель на базе указателей/объектов</h4><section class="doc-section level-4"><h5 id=_объект_значение_это_симуляция_данных_в_языках_в_которых_есть_только_объекты>Объект-значение (это симуляция данных в языках, в которых есть только объекты)</h5></section><section class="doc-section level-4"><h5 id=_свойства_поляатрибуты>Свойства (поля/атрибуты)</h5><p>Сущности концептуально изменяемы.
Но представлять их лучше как последовательность неизменяемых данных</p></section></section><section class="doc-section level-3"><h4 id=_эпохальная_модель_времени>Эпохальная модель времени</h4></section></section><section class="doc-section level-2"><h3 id=_переход_подводка>переход-подводка</h3><p>(<mark>todo: коммент</mark>)</p><p>Основной задачей ИС является хранение информации о реальном мире.
Реальный мир моделируется посредством сущностей и связей между ними.
Сущности идентифицируются ключём - идентификатором.</p><p>В программе сущности представляются объектами, которые могут быть изменяемыми, либо неизменяемыми.</p><p>Связи между сущностями могут быть представлены либо ссылкой на объект ссылаемой сущности, либо идентификатором ссылаемой сущности.
Большинство (все?) связи в реальном мире двунаправленные - по учебной группе можно определить всех преподавателей этой группы, а по преподавателю можно определить все обучаемые им группы.
Но в программе их можно моделировать ограничиться однонаправленной связью.</p></section><section class="doc-section level-2"><h3 id=_объектно_ориентированный_подход>Объектно-ориентированный подход</h3><p>Сейчас самым распространённым подходом к моделированию реальности является объектно-ориентированный.
Этот подход представляет информацию в виде полносвязного (через ссылки), двунаправленного графа изменяемых объектов.
Такой подход знаком всем программистам и лёгок в решении локальных задач - имея ссылку на объект, можно пройтись по ссылкам и добраться до любого другого объекта и тут же его изменить.
Но эта лёгкость несёт и большое количество проблем.</p><p>Проблемы связанные с изменяемыми объектами находятся за рамками темы поста и сейчас я рассмотрю только проблемы вызванные представлением связей как двунаправленных ссылок.
Такой подход несёт проблемы в двух аспектах - дизайне и производительности.</p><p>Возьму за аксиомы два утверждения:
. декомпозиция системы на слабосвязные модули - это хорошо
. наличие циклов в связях между модулями - это плохо</p><p>Так вот традиционный подход к моделированию информации исключает возможность декомпозиции системы на модули - код из любого модуля, может по ссылкам добраться до объекта из любого другого модуля в обход этого модуля и как минимум считать информацию.
А двунаправленные связи создают циклы в связях между модулями.</p><p>Результатом этого является архитектура "Большой ком грязи", при которой изменение в любой функции может внести регрессию в любую другую функцию и любой рефакторинг может потребовать изменений по всей кодовой базе.</p><p>Из того, что система превращается в большой ком грязи также следуют и проблемы с производительностью.
Если данные хранятся в БД, а информация представлена полносвязным двунапрвленным графом, то попытка загрузить любой объект из БД приведёт к загрузке (по ссылкам) практически всей БД в память программы.
Естественно, на практике это невозможно и для обхода этой проблемы современные ОРМы используют ленивую загрузку.
Но ленивая загрузка приносит с собой проблему нелокальности рассуждений - глядя только на вызов геттера невозможно сказать отработает ли он в памяти или же выполнит запрос к БД.</p><p>Кроме того, ленивая загрузка усугубляет проблемы производительности при работе с отношениями один ко многому, когда "много" - это действительно много.
В этом случае даже загрузка только идентификаторов может стать проблемой, если их тысячи.
А если потом ссылаемые объекты будут загружаться по одному, то это фактически парализует работу приложения.
И даже если ссылаемых объектов всего десятки - этого количества достаточно чтобы загрузка объектов по одному превратилась в проблему (у это проблемы даже есть собственное имя - N + 1).</p><p>Наконец, отсутствие видимых границ в данных приводит к тому, что в одну транзакцию попадают слабосвязанные между собой изменения, что приводит к увеличению транзакции (количества изменяемых данных и длительности), что приводит либо к дата рейсам, либо к повышению оверхеда на синхронизацию.</p></section><section class="doc-section level-2"><h3 id=_реляционный_подход>Реляционный подход</h3><p>Другой крайностью к моделированию информации является реляционная модель.
Если вытащить реляционную модель на уровень программы, то она будет представлять из себя набор ассоциативных массивов, содержащих объекты.</p><p>Связи между объектами реализуются через идентификаторы - некий ключ, который содержит указание на массив, в котором содержится объект и ключ по которому его искать.
При этом связи достаточно делать однонаправленными - для того чтобы пройти по обратному направлению (найти объекты ссылающиеся на данный) достаточно выполнить запрос к массиву ссылающихся объектов и отфильтровать их по значению связи.</p><p>Наконец, если симуляцию работы с БД доводить до конца, объекты должны быть как минимум копиями - ни кто не должен видеть изменения в объекте, до тех пор пока программа не сохранит его в массиве (аналог UPDATE + COMMIT).</p><p>Такой подход решает все проблемы присущие объектно-ориентированному.</p><p>Если ассоциативный массив скрыть за интерфейсом модуля (сервиса или репозитория), то модуль будет контролировать все обращения к массиву.
Двунаправленные ссылки хоть и формально возможны в реляционной модели, но настоятельно не рекомендуются, т.к. ведут к дублированию информации.</p><p>Проблемы с загрузкой полного графа объектов нет по определению.
Благодаря этому нет необходимости в ленивой загрузке и как следствие утери локальности рассуждений.
Вместе с ленивой загрузкой уходит и проблема N+1.
А проблема огромного списка идентификаторов исключается требованием к первой нормальной форме (атомарность атрибутов) и возможность проходить по связям в обратном направлении.</p><p>Наконец, в реляционной модели есть жёсткая граница между элементами модели и для того чтобы внести в транзакцию новую сущность, потребуется приложить существенные усилия (как минимум выполнить дополнительный запрос, а может и добавить ссылку на модуль/класс, который позволит этот запрос выполнить) и у разработчика будет шанс задуматься о влиянии изменения на размер транзакции.</p><p>Однако у реляционного подхода есть проблема - обеспечение инвариантов включающих несколько сущностей.
Если каждую сущность можно изолировано модифицировать, то такая модификация может привести к нарушению инварианта.</p><p>Возьмём классический пример с заказами и позициями заказа.
А в качестве инварианта возьмём следующий: "Сумма стоимости позиций заказа с постплатой не должна превышать 1000 рублей".
В этом случае изменение цены или количества отдельной взятой позиции может привести к нарушению этого инварианта.</p><p>Эту проблему можно решить, если нарушить требования первой нормальной формы и поместить список позиций заказа "внутрь" сущности заказа и смоделировать связь посредствам ссылки, а не идентификаторов.
Такую вариацию реляционного подхода я называют функциональным подходом к моделированию данных.</p><p>Но это скользкий путь - если зайти слишком далеко, то мы снова придём к ОО-модели со всеми её проблемами.</p><p>Для того чтобы понять какие связи моделировать ссылками, а какие идентификторами я использую концепцию агрегата из Domain-Driven Design - кластера сущностей, которые должны быть всегда согласованы между собой и удовлетворять бизнес-правилам.</p></section><section class="doc-section level-2"><h3 id=_ddd_подход>DDD-подход</h3><p>Таким образом получается, что DDD-подход является комбинацией ООП/ФП и реляционного подхода.
Внутри агрегатов используется объектно-ориентированная или функциональная модель - связи моделируются ссылками.
А между агрегатами используется реляционная модель - связи моделируются идентификаторами.</p><p>DDD-предполагает нарезку модели данных на агрегаты - кластеры сущностей, которые:</p><div class="olist arabic"><ol class=arabic><li>Должны быть всегда и строго согласованы</li><li>Поэтому являются единицей персистанса - всегда загружаются и сохраняются целиком</li><li>Поэтому должны быть минимально возможного размера (при соблюдении п.1)</li></ol></div><p>Такая комбинация позволяет обеспечить соблюдение инвариантов, без проблем с дизайном и производительностью, свойственных ОО-подходу.</p></section></section></article></section></div></main><script src=/js/app.js></script></body></html>