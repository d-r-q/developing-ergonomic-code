<!doctype html><html lang=ru-ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Алексей Жидков"><meta name=description content="https://azhidkov.pro/"><meta property="og:site_name" content="Алексей Жидков"><meta property="og:title" content="REST, фронт и все-все-все - Алексей Жидков"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://azhidkov.pro/microposts/23/06/rest-fronts-and-others/"><meta property="og:image" content="https://azhidkov.pro/"><meta name=twitter:card content="summary"><meta name=twitter:site content="https://azhidkov.pro/microposts/23/06/rest-fronts-and-others/"><meta name=twitter:image content="https://azhidkov.pro/"><base href=https://azhidkov.pro/microposts/23/06/rest-fronts-and-others/><title>REST, фронт и все-все-все - Алексей Жидков</title><link rel=canonical href=https://azhidkov.pro/microposts/23/06/rest-fronts-and-others/><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700"><link rel=stylesheet href=/css/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css><link rel=stylesheet href=https://azhidkov.pro/css/custom.css><link rel=stylesheet href=https://azhidkov.pro/css/github.css><link rel=stylesheet href=https://azhidkov.pro/css/JetBrains-Mono.css><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=alternate href=https://azhidkov.pro/index.xml type=application/rss+xml title="Алексей Жидков"><link href=https://azhidkov.pro/index.xml rel=feed type=application/rss+xml title="Алексей Жидков"><meta name=generator content="Hugo 0.80.0"></head><body><main class=wrapper><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://azhidkov.pro/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://azhidkov.pro/favicon-16x16.png><link rel=manifest href=site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet type=text/css><nav class=navigation><section class=container style=height:100%><img src=https://azhidkov.pro/images/logo.svg class=logo>
<a class=navigation-title href=/>Алексей Жидков</a>
<input type=checkbox id=menu-control>
<label class="menu-mobile float-right" for=menu-control><span class="btn-mobile float-right">&#9776;</span><ul class=navigation-list><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/ergo-approach/landing>Эргономичный подход</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/effects-diagram/landing>Диаграмма Эффектов</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/posts>Блог</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/portfolio>Портфолио</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/>Контакты</a></li><li class=mobile-menu-lang-separator-full><hr></li></ul></label></section></nav><div class=content><section class="container page"><article><header><h1>REST, фронт и все-все-все</h1></header><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>Этот материал является "микропостом" - текстом, написанным в режиме потока сознания без особой редактуры.</p><p>Следить за обновлениями блога можно в моём канале: <a href=https://t.me/ergonomic_code>Эргономичный код</a></p></aside><p>Я прочитал штук пять книг по REST, включая диссертацию Филдинга и для себя пришёл к выводу, что REST без HATEOS - это не REST.
А HATEOS в случае толстых клиентов не работает.
Соответственно смирился с тем, что мы (90% индустрии) на самом деле делаем RPC over HTTP и успокоился.</p><p>А потом наткнулся на <a href=https://htmx.org/>htmx</a> и <a href=https://alpinejs.dev/>alpine.js</a>, с которым сейчас потихоньку играюсь и пока что в восторге - для проектов, в которых я участвовал за всю свою карьеру этого более чем достаточно и они намного проще React-ового адка, имхо.
И тут уже HATEOS вполне себе работает.</p><p>Однако, я пока не представляю как хотя бы на вэб затащить htmx+alpine в коммерческих проектах, а с нативными фронтами вообще труба.
Поэтому для меня HATEOS оставался скорее академической штукой, чем практической.</p><p>Пока я не посмотрел <a href="https://www.youtube.com/watch?v=93UK4gwV41c&list=PLe6FX2SlkJdTlHjktJqUWaFtaRBOkZ8JZ&index=38">REST next level: Crafting domain-driven web APIs by Julien Topçu @ Spring I/O 2023</a>.
И вот тут у меня что-то наконец щёлкнуло и я, кажется, понял как превратить HATEOS в решение, которое повысит скорость разработки и стабильность моих систем за счёт снижения сцепленности фронтов с бэком и снижения кол-ва бизенс-логики во фронтах (и как следствие упрощения её тестирования).</p><p>Делать далеко идущие выводы я пока не готов, но совершенно точно готов дать HATEOS второй шанс в каком-нибудь пет-проекте.</p><hr><p>Знаю, что у меня в подписчиках много молодых разработчиков - следущая история для вас, мои дорогие:)</p><p>Недавно на Проекте Э у нас был примерно такой случай.</p><p>QA заводит баг, говорит генерация отчётов не работает, бэк возвращает ошибку и вешает его на бэк.
Бакэндер его смотрит и говорит - ну у нас конечно есть проблема на бэке, что отчёт долго генерируется, но вообще-то это фронт дурак - присылает второй запрос до получения ответа.
А у нас отчёты генерируются по одноразовому токену, соответственно второй запрос тут же получает ошибку.
И возвращает баг на фронт.</p><p>Приходит фронтендер и говорит: сами вы дураки - я один раз запрос отправляю.</p><p>За пару недель это цикл в вялотекущем режиме повторился сколько-то раз.</p><p>Пока я не пришёл, не открыл слева логи браузера, справа логи бэка и не увидел, что фронт действительно отсылает один запрос, а на бэк их приходит два.</p><p>Мистика?
Нет, если знать ещё два бита информации:</p><div class="olist arabic"><ol class=arabic><li>В наследство нам досталась генерация отчёта (с инвалидацией токена) GET-методом;</li><li>Между фронтом и бэком у нас сидит nginx.</li></ol></div><p>А nginx при проксировании <a href=http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_next_upstream>по дефолту повторяет</a> идемпотентные (<a href=https://datatracker.ietf.org/doc/html/rfc7231#section-4.2.2>спека</a>) запросы по истечению таймаута.
Вот и вся магия.</p><p>Более того, GET-запросы должны быть не просто идемпотентными, а <a href=https://datatracker.ietf.org/doc/html/rfc7231#section-4.2.1>безопасными</a>.</p><p>Отсюда выводы:</p><div class="olist arabic"><ol class=arabic><li>Проектируйте свои HTTP API вообще и REST API в частности, в согласно соответствующим спецификациям и принципам;</li><li>Делайте свои GET-запросы хотя бы идемпотентными;</li><li>И наоборот идмемпотентные запросы не делайте POST-ами (как пример - запросы с какими-нибудь развесистыми поисковыми формами);</li><li>Если не знаете, что значит идемпотентный - срочно узнайте:)</li></ol></div></article></section></div></main><script src=/js/app.js></script></body></html>