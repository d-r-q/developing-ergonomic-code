<!doctype html><html lang=ru-ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Алексей Жидков"><meta name=description content="https://azhidkov.pro/"><meta property="og:site_name" content="Алексей Жидков"><meta property="og:title" content="Функциональные программы проще понимать - Алексей Жидков"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://azhidkov.pro/microposts/22/12/why-fp-simpler/"><meta property="og:image" content="https://azhidkov.pro/"><meta name=twitter:card content="summary"><meta name=twitter:site content="https://azhidkov.pro/microposts/22/12/why-fp-simpler/"><meta name=twitter:image content="https://azhidkov.pro/"><base href=https://azhidkov.pro/microposts/22/12/why-fp-simpler/><title>Функциональные программы проще понимать - Алексей Жидков</title><link rel=canonical href=https://azhidkov.pro/microposts/22/12/why-fp-simpler/><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700"><link rel=stylesheet href=/css/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css><link rel=stylesheet href=https://azhidkov.pro/css/custom.css><link rel=stylesheet href=https://azhidkov.pro/css/github.css><link rel=stylesheet href=https://azhidkov.pro/css/JetBrains-Mono.css><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=alternate href=https://azhidkov.pro/index.xml type=application/rss+xml title="Алексей Жидков"><link href=https://azhidkov.pro/index.xml rel=feed type=application/rss+xml title="Алексей Жидков"><meta name=generator content="Hugo 0.80.0"></head><body><main class=wrapper><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://azhidkov.pro/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://azhidkov.pro/favicon-16x16.png><link rel=manifest href=site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet type=text/css><nav class=navigation><section class=container style=height:100%><img src=https://azhidkov.pro/images/logo.svg class=logo>
<a class=navigation-title href=/>Алексей Жидков</a>
<input type=checkbox id=menu-control>
<label class="menu-mobile float-right" for=menu-control><span class="btn-mobile float-right">&#9776;</span><ul class=navigation-list><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/ergo-approach/landing>Эргономичный подход</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/effects-diagram/landing>Диаграмма Эффектов</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/posts>Блог</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/portfolio>Портфолио</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/>Контакты</a></li><li class=mobile-menu-lang-separator-full><hr></li></ul></label></section></nav><div class=content><section class="container page"><article><header><h1>Функциональные программы проще понимать</h1></header><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>Этот материал является "микропостом" - текстом, написанным в режиме потока сознания без особой редактуры.</p><p>Следить за обновлениями блога можно в моём канале: <a href=https://t.me/ergonomic_code>Эргономичный код</a></p></aside><p>Последние несколько дней перечитывают <a href=https://www.tedinski.com/archive/>блог</a> (кто бы мог подумать, чтоб блоги тоже можно перечитывать) Тэда Каминского.
Во-первых, в очередной раз настоятельно рекомендую его почитать - там очень много очень мудрых мыслей, мужик прям понимает суть программирования.</p><p>Во-вторых, там снова откопал <a href=https://semantic-domain.blogspot.com/2018/04/are-functional-programs-easier-to.html>пост</a>, который объясняет почему ФП проще.</p><p>Строго говоря в этом посте есть слабое место - автор берёт за аксиому то, что понимать программы сильно сложнее, когда они используют подпрограммы (методы, функции, процедуры), ссылки/указатели и изменяемое состояние.
Их комбинация лишает разрботчика возможности понять что делает подпрограмма, глядя только на саму подпрограмму (и декларации вызываемых подпрограмм).
Уберите любое из трёх - и такая возможность появляется.
ФП убирает изменяемое состояние.
И делает возможным понять что делает подпрограмма, глядя только на саму подпрограмму.
Что проще чем, изучить всё поддерево вызовов.</p><p>ч.т.д.</p><p>Практическая иллюстрация к теории.</p><p>Возьмём программу:</p><div class=listing-block><pre class="rouge highlight"><code data-lang=kotlin><span class=k>fun</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=kd>val</span> <span class=py>els</span><span class=p>:</span> <span class=nc>ArrayList</span><span class=p>&lt;</span><span class=nc>Int</span><span class=p>&gt;</span> <span class=p>=</span> <span class=nf>arrayListOf</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
    <span class=kd>val</span> <span class=py>sum</span> <span class=p>=</span> <span class=nf>sum</span><span class=p>(</span><span class=n>els</span><span class=p>)</span>
    <span class=nf>println</span><span class=p>(</span><span class=s>&#34;Сумма ${els[0]} + ${els[1]} = $sum&#34;</span><span class=p>)</span>
<span class=p>}</span>

<span class=k>fun</span> <span class=nf>sum</span><span class=p>(</span><span class=n>els</span><span class=p>:</span> <span class=nc>ArrayList</span><span class=p>&lt;</span><span class=nc>Int</span><span class=p>&gt;):</span> <span class=nc>Int</span> <span class=p>=</span> <span class=nc>TODO</span><span class=p>()</span></code></pre></div><p>Что мы можем сказать про поведение этой программы?
Да ничего.
Даже если вынести за скобки то, что прямо сейчас она вылетит с исключением (так реализована TODO) - всё равно ничего.</p><p>Потому что <code>sum</code> может быть реализована например так:</p><div class=listing-block><pre class="rouge highlight"><code data-lang=kotlin><span class=k>fun</span> <span class=nf>sum</span><span class=p>(</span><span class=n>els</span><span class=p>:</span> <span class=nc>ArrayList</span><span class=p>&lt;</span><span class=nc>Int</span><span class=p>&gt;):</span> <span class=nc>Int</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=py>sum</span> <span class=p>=</span> <span class=mi>0</span>
    <span class=k>while</span> <span class=p>(</span><span class=n>els</span><span class=p>.</span><span class=nf>isNotEmpty</span><span class=p>())</span> <span class=p>{</span>
        <span class=n>sum</span> <span class=p>+=</span> <span class=n>els</span><span class=p>.</span><span class=nf>remove</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=mi>0</span>
<span class=p>}</span></code></pre></div><p>В результате у нас будет IndexOutOfBoundsException.
И не надо закатывать глаза, мол это синтетический пример - у меня был баг в проде из-за подобного кода.
Возможно именно с тех пор я такой - я был жертвой такого сюрприза и внёс баг вызвав казалось бы безопасную функцию.</p><p>Теперь давайте давайте посмотрим, что будет если убрать любую из трёх штук из начала поста.</p><p>Убираем подпрограммы - адская реализация sum попадает в локальную область видимости, всё встаёт на свои места.</p><p>Убираем изменяемое состояние или заменяем передачу списка по ссылке на передачу по значению - и мы уже можем быть уверены в том, что наша программа выведет "Сумма 2 + 2 = $sum".</p><p>Понятно, что в Котлине (не чистом функциональном языке) даже если мы передадим в sum неизменяемый массив, нам в ответ всё равно может прилететь исключение или функция может потихоньку продовую базу дропнуть.
Но если мы на уровне соглашений и ревью поделим код на императивный и чистый и максимум кода будем делать чистым, то мы существенно обезопасим себя от таких сюрпризов.</p><p>При том первый пример с инлайном показывает, что локальное изменяемое состояние не нарушает локальности рассуждений и вполне допуситмо.
А моя практика показывает, что некоторые задачи решаются проще с помощью изменяемого состояния.</p><p>Например, такую функцию без состояния:</p><div class=listing-block><pre class="rouge highlight"><code data-lang=kotlin><span class=k>private</span> <span class=kd>val</span> <span class=py>signals</span> <span class=p>=</span> <span class=nc>Signal</span><span class=p>.</span><span class=nf>values</span><span class=p>()</span>
<span class=k>private</span> <span class=k>infix</span> <span class=k>fun</span> <span class=nc>Int</span><span class=p>.</span><span class=nf>hasBit</span><span class=p>(</span><span class=n>n</span><span class=p>:</span> <span class=nc>Int</span><span class=p>)</span> <span class=p>=</span> <span class=k>this</span> <span class=n>shr</span> <span class=n>n</span> <span class=n>and</span> <span class=mi>1</span> <span class=p>==</span> <span class=mi>1</span>

<span class=k>fun</span> <span class=nf>calculateHandshake</span><span class=p>(</span><span class=n>n</span><span class=p>:</span> <span class=nc>Int</span><span class=p>)</span> <span class=p>=</span>
        <span class=n>signals</span>
            <span class=p>.</span><span class=nf>filterIndexed</span> <span class=p>{</span> <span class=n>i</span><span class=p>,</span> <span class=n>_</span> <span class=p>-&gt;</span> <span class=n>n</span> <span class=n>hasBit</span> <span class=n>i</span> <span class=p>}</span>
            <span class=p>.</span><span class=nf>let</span> <span class=p>{</span> <span class=k>if</span> <span class=p>(</span><span class=n>n</span> <span class=n>hasBit</span> <span class=n>signals</span><span class=p>.</span><span class=n>size</span><span class=p>)</span> <span class=n>it</span><span class=p>.</span><span class=nf>reversed</span><span class=p>()</span> <span class=k>else</span> <span class=n>it</span> <span class=p>}</span></code></pre></div><p>намного сложнее понять, чем её аналог с состоянием:</p><div class=listing-block><pre class="rouge highlight"><code data-lang=kotlin><span class=k>fun</span> <span class=nf>calculateHandshake</span><span class=p>(</span><span class=n>number</span><span class=p>:</span> <span class=nc>Int</span><span class=p>):</span> <span class=nc>List</span><span class=p>&lt;</span><span class=nc>Signal</span><span class=p>&gt;</span> <span class=p>{</span>
    <span class=kd>val</span> <span class=py>signalsList</span> <span class=p>=</span> <span class=n>mutableListOf</span><span class=p>&lt;</span><span class=nc>Signal</span><span class=p>&gt;()</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>number</span> <span class=n>and</span> <span class=mi>1</span> <span class=p>==</span> <span class=mi>1</span><span class=p>)</span> <span class=n>signalsList</span><span class=p>.</span><span class=nf>add</span><span class=p>(</span><span class=nc>Signal</span><span class=p>.</span><span class=nc>WINK</span><span class=p>)</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>number</span> <span class=n>and</span> <span class=mi>2</span> <span class=p>==</span> <span class=mi>2</span><span class=p>)</span> <span class=n>signalsList</span><span class=p>.</span><span class=nf>add</span><span class=p>(</span><span class=nc>Signal</span><span class=p>.</span><span class=nc>DOUBLE_BLINK</span><span class=p>)</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>number</span> <span class=n>and</span> <span class=mi>4</span> <span class=p>==</span> <span class=mi>4</span><span class=p>)</span> <span class=n>signalsList</span><span class=p>.</span><span class=nf>add</span><span class=p>(</span><span class=nc>Signal</span><span class=p>.</span><span class=nc>CLOSE_YOUR_EYES</span><span class=p>)</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>number</span> <span class=n>and</span> <span class=mi>8</span> <span class=p>==</span> <span class=mi>8</span><span class=p>)</span> <span class=n>signalsList</span><span class=p>.</span><span class=nf>add</span><span class=p>(</span><span class=nc>Signal</span><span class=p>.</span><span class=nc>JUMP</span><span class=p>)</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>number</span> <span class=n>and</span> <span class=mi>16</span> <span class=p>==</span> <span class=mi>16</span><span class=p>)</span> <span class=n>signalsList</span><span class=p>.</span><span class=nf>reverse</span><span class=p>()</span>
    <span class=k>return</span> <span class=n>signalsList</span>
<span class=p>}</span></code></pre></div><p>Итого - используйте функциональную архитектуру, при необходимости в реализации чистых функций используйте изменяемое состояние и будет вам счастье.</p></article></section></div></main><script src=/js/app.js></script></body></html>