<!doctype html><html lang=ru-ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Алексей Жидков"><meta name=description content="https://azhidkov.pro/"><meta property="og:site_name" content="Алексей Жидков"><meta property="og:title" content="- Алексей Жидков"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://azhidkov.pro/effects-diagram/specification-base/"><meta property="og:image" content="https://azhidkov.pro/"><meta name=twitter:card content="summary"><meta name=twitter:site content="https://azhidkov.pro/effects-diagram/specification-base/"><meta name=twitter:image content="https://azhidkov.pro/"><base href=https://azhidkov.pro/effects-diagram/specification-base/><title>- Алексей Жидков</title><link rel=canonical href=https://azhidkov.pro/effects-diagram/specification-base/><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700"><link rel=stylesheet href=/css/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css><link rel=stylesheet href=https://azhidkov.pro/css/custom.css><link rel=stylesheet href=https://azhidkov.pro/css/github.css><link rel=stylesheet href=https://azhidkov.pro/css/JetBrains-Mono.css><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=alternate href=https://azhidkov.pro/index.xml type=application/rss+xml title="Алексей Жидков"><link href=https://azhidkov.pro/index.xml rel=feed type=application/rss+xml title="Алексей Жидков"><meta name=generator content="Hugo 0.80.0"></head><body><main class=wrapper><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://azhidkov.pro/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://azhidkov.pro/favicon-16x16.png><link rel=manifest href=site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet type=text/css><nav class=navigation><section class=container style=height:100%><img src=https://azhidkov.pro/images/logo.svg class=logo>
<a class=navigation-title href=/>Алексей Жидков</a>
<input type=checkbox id=menu-control>
<label class="menu-mobile float-right" for=menu-control><span class="btn-mobile float-right">&#9776;</span><ul class=navigation-list><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/ergo-approach/landing>Эргономичный подход</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/effects-diagram/landing>Диаграмма Эффектов</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/posts>Блог</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/portfolio>Портфолио</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/>Контакты</a></li><li class=mobile-menu-lang-separator-full><hr></li></ul></label></section></nav><div class=content><section class="container page"><article><header><h1></h1></header><section class="doc-section level-1"><h2 id=_история_изменений><a class=link href=#_история_изменений>История изменений</a></h2><section class="doc-section level-2"><h3 id=_v0_1_0><a class=link href=#_v0_1_0>v0.1.0</a></h3><p>(<mark>todo: коммент</mark>)</p></section><section class="doc-section level-2"><h3 id=_v0_0_2><a class=link href=#_v0_0_2>v0.0.2</a></h3><div class="olist arabic"><ol class=arabic><li>Изменение условного обозначения событий: отказ от представления отдельными блоками в пользу стрелок.</li><li>Переход к использованию визуального языка C4 Model.</li></ol></div></section><section class="doc-section level-2"><h3 id=_v0_0_1><a class=link href=#_v0_0_1>v0.0.1</a></h3><p>Опубликована первая версия.</p></section></section><section class="doc-section level-1"><h2 id=_введение><a class=link href=#_введение>Введение</a></h2><p>Диаграмма эффектов — инструмент для разработчиков, предназначенный для визуализации поведения информационной системы через описание её взаимодействия с внешним миром.</p><p>Диаграмма эффектов полезна на всех этапах разработки ПО — от первичного анализа до планирования работ и поддержки. Она позволяет с минимальными затратами:</p><div class=ulist><ul><li>получить целостную картину реализации будущей системы;</li><li>оценить трудоёмкость разработки;</li><li>декомпозировать систему на модули;</li><li>определить порядок выполнения работ;</li><li>уменьшить количество регрессий при внесении изменений в систему.</li></ul></div></section><section class="doc-section level-1"><h2 id=_концептуальная_модель><a class=link href=#_концептуальная_модель>Концептуальная модель</a></h2><p>Максимально абстрактно, информационную систему можно представить как устройство по изменению состояния окружающего мира в ответ на изменения в окружающем мире.</p><p>В диаграмме эффектов такие устройства моделируются с помощью четырёх основных элементов:</p><div class="olist arabic"><ol class=arabic><li>События - типы изменений в окружающем мире, на которые реагирует система;</li><li>Ресурсы - части окружающего мира, которые система изменяет в процессе своей работы;</li><li>Эффекты - атомарные единицы взаимодействия системы с окружающим миром;</li><li>Операции - группы эффектов, образующие функции системы.</li></ol></div><section class="doc-section level-2"><h3 id=_событие><a class=link href=#_событие>Событие</a></h3><p><strong>Событие</strong> - это обнаруженное изменение части окружающего мира.
Изменение определяется посредством сравнения текущего наблюдаемого состояния окружающего мира с его предыдущим известным состоянием.
В современных информационных системах отслеживанием изменений обычно занимаются низкоуровневые компоненты - операционные системы, middleware, фреймворки и библиотеки - поэтому на уровне прикладного приложения, события превращаются в вызов кода системы, переданного в такой компонент.</p><p>События могут генерироваться в следствии любого изменения, либо только в том случае предыдущее и/или текущее состояние определяет определённым условиям.</p><p>Примеры событий:</p><div class="olist arabic"><ol class=arabic><li>Поступил HTTP-запрос;</li><li>Появилось новое сообщение в очереди;</li><li>Наступила полночь;</li><li>Была нажата кнопка мыши.</li></ol></div><p>В ответ на события, система реагирует новыми изменениями окружающего мира, части которого представлены в системе ресурсами.</p></section><section class="doc-section level-2"><h3 id=_ресурс><a class=link href=#_ресурс>Ресурс</a></h3><p><strong>Ресурс</strong> - это именованная область изменяемого состояния.
Такой областью может выступать:</p><div class="olist arabic"><ol class=arabic><li>Глобальная переменная, хранящая примитивное значение;</li><li>Таблица в реляционной БД;</li><li>Топик очереди сообщений;</li><li>ресурс REST API внешней системы.</li></ol></div><p>Ресурсы предоставляют API для считывания и изменения своего состояния.</p><p>Система может быть настроена реагировать на события изменения собственного ресурса.
В этом случае события могут образовывать каскад - обработка события А порождает событие Б, которое вновь обрабатывается той же системой и может привести к порождению события В и т.д.</p><p>Как правило, реагирует на изменения в специализированных ресурсах, вроде топика очереди сообщений.
Но, например, при помощи триггеров и оператора NOTIFY в PostgreSQL, можно реализовать порождение события и в результате изменения ресурса реляционной таблицы.</p><p>Вызовы API ресурсов являются эффектами работы системы.</p></section><section class="doc-section level-2"><h3 id=_эффект><a class=link href=#_эффект>Эффект</a></h3><p><strong>Эффект</strong> — это атомарный на данном уровне абстракции акт считывания или изменения некоторого состояния (ресурса).</p><p>Эффекты чтения характеризуются тем, что считывание одного и того же состояния в разные моменты времени может дать разные результаты.
А эффекты изменения (или записи) характеризуются тем, что изменённое состояние можно наблюдать за пределами текущего фрейма стэка потока выполнения.</p><p>Примеры эффектов:</p><div class=ulist><ul><li>чтение и запись статической переменной;</li><li>чтение и запись файла;</li><li>выборка или обновление данных в таблице реляционной БД;</li><li>отправка HTTP-запросов.</li></ul></div><p>Атомарный на одном уровне эффект, может быть реализован несколькими эффектами на более низком уровне.
Например эффект вставки строки в таблицу РСУБД, в самой РСУБД приведёт к целой группе эффектов - считывание и запись страницы таблицы, считывание и запись страниц индексов таблицы, обновление последовательности генерации первичных ключей и т.д.</p><p>С другой стороны, группа эффектов того же уровня, на более высоком уровне будет выглядеть атомарной.
Такая группа эффектов образует операцию системы.</p></section><section class="doc-section level-2"><h3 id=_операция><a class=link href=#_операция>Операция</a></h3><p><strong>Операция</strong> - это атомарная единица полезной работы, которую система предоставляет для своих пользователей.
В процессе своей работы, операция, как правило, выполняет один или несколько эффектов чтения и записи.</p><p>Система реагирует на события именно посредством операций.
Система может реагировать несколькими операциями в ответ на одно событие или наоборот реагировать одной и той же операцией, в ответ на разные события.</p></section></section><section class="doc-section level-1"><h2 id=_применение><a class=link href=#_применение>Применение</a></h2><p>Диаграмма эффектов даёт чёткое представление об операциях системы, необходимое на всех этапах жизненного цикла разработки.</p><div class="olist arabic"><ol class=arabic><li>На этапе <strong>поддержки и развития</strong> диаграмма позволяет описать текущее наблюдаемое поведение системы и спрогнозировать, как оно поменяется после внесения изменений в систему. Благодаря этому можно заметить нежелательные изменения и, таким образом, избежать регрессий.</li><li>На этапе <strong>анализа требований</strong> к системе диаграмма эффектов помогает переформулировать требования в абстракциях будущей программы.</li><li>На этапе <strong>оценки</strong> диаграмма позволяет точнее определить состав работ (на основе списка операций) и трудоёмкость (на основе списка событий, требуемых эффектов и целевых ресурсов).</li><li>На этапе <strong>проектирования системы</strong> операции и ресурсы диаграммы становятся ключевыми блоками, правильная декомпозиция которых поможет создать основу для системы с низкой сцепленностью.</li><li>На этапе <strong>реализации</strong> взаимосвязь операций через ресурсы помогает определить порядок выполнения работ и те работы, которые могут быть выполнены параллельно.</li></ol></div></section><section class="doc-section level-1"><h2 id=_нотация><a class=link href=#_нотация>Нотация</a></h2><p>В основе визуального языка диаграммы эффектов лежит язык <a href=https://c4model.com/>модели C4</a>.
Это позволяет встраивать диаграмму эффектов в модель C4 на четвёртом уровне — в качестве диаграммы кода.</p><p>Нотация диаграммы эффектов бывает двух типов — краткая и полная.</p><section class="doc-section level-2"><h3 id=_краткая_нотация><a class=link href=#_краткая_нотация>Краткая нотация</a></h3><p>В краткой нотации используются 4 элемента, которые составляют ядро диаграммы эффектов:</p><div class=ulist><ul><li>операции;</li><li>ресурсы;</li><li>эффекты;</li><li>примечания.</li></ul></div></section><section class="doc-section level-2"><h3 id=_полная_нотация><a class=link href=#_полная_нотация>Полная нотация</a></h3><p>В полной нотации добавляются элементы:</p><div class=ulist><ul><li>события;</li><li>описания операций и ресурсов в формате модели C4;</li><li>границы контейнера из C4;</li><li>внешние системы, базы данных и компоненты из C4.</li></ul></div><p>Расширять состав диаграммы можно постепенно, добавляя только те элементы, которые помогают в решении текущей задачи.</p></section><section class="doc-section level-2"><h3 id=_критерии_выбора_нотации><a class=link href=#_критерии_выбора_нотации>Критерии выбора нотации</a></h3><p><strong>Краткая нотация</strong> подойдёт, если:</p><div class=ulist><ul><li>требуется быстро разбить систему на модули;</li><li>необходимо спланировать модификацию сложной или незнакомой операции;</li><li>диаграмму будет использовать только автор в течение непродолжительного времени и повторное возвращение к ней не планируется.</li></ul></div><p><strong>Полная нотация</strong> рекомендуется, если:</p><div class=ulist><ul><li>нужно оценить проект для работы за фиксированную цену и минимизировать вероятность потери существенных деталей;</li><li>планируется опубликовать диаграмму или использовать её через длительный срок после создания.</li></ul></div></section><section class="doc-section level-2"><h3 id=_пример_диаграммы_эффектов><a class=link href=#_пример_диаграммы_эффектов>Пример диаграммы эффектов</a></h3><p>Оба вида нотации рассматриваются на примере визуализации процесса регистрации и аутентификации пользователей в произвольной системе. После успешной регистрации пользователям отправляется приветственное письмо.</p><p>Диаграмма эффектов с использованием краткой нотации:</p><div class=image-block><a class=image href={imagesdir}/short-notation-example.png><img src=short-notation-example.png alt="short notation example"></a></div><p>Диаграмма эффектов с использованием полной нотации:</p><div class=image-block><a class=image href={imagesdir}/full-notation-example.png><img src=full-notation-example.png alt="full notation example"></a></div></section><section class="doc-section level-2"><h3 id=_элементы_диаграммы_эффектов><a class=link href=#_элементы_диаграммы_эффектов>Элементы диаграммы эффектов</a></h3><section class="doc-section level-3"><h4 id=_операции><a class=link href=#_операции>Операции</a></h4><p>Операции обозначаются прямоугольником с именем операции:</p><div class=image-block><img src=operation.png alt=operation></div></section><section class="doc-section level-3"><h4 id=_ресурсы><a class=link href=#_ресурсы>Ресурсы</a></h4><p>Ресурсы обозначаются прямоугольником с именем ресурса и цветом, отличным от цвета операции:</p><div class=image-block><img src=resource.png alt=resource></div></section><section class="doc-section level-3"><h4 id=_эффекты><a class=link href=#_эффекты>Эффекты</a></h4><p><strong>Эффект модификации ресурса</strong> обозначается утолщённой линией со стрелкой от операции к ресурсу и сопровождается кратким описанием эффекта:</p><div class=image-block><img src=operation-resource-rw.png alt="operation resource rw"></div><p><strong>Эффект чтения ресурса</strong> обозначается обычной линией со стрелкой от ресурса к операции и сопровождается кратким описанием считываемых данных:</p><div class=image-block><img src=operation-resource-ro.png alt="operation resource ro"></div></section><section class="doc-section level-3"><h4 id=_примечания><a class=link href=#_примечания>Примечания</a></h4><p>На диаграмму можно помещать заметки и примечания.
Рекомендуемое обозначение <strong>примечаний</strong> — «лист» с загнутым углом, связанный прерывистой линией с комментируемым элементом, но можно использовать и обозначения из других нотаций.</p><div class=image-block><img src=note.png alt=note></div></section><section class="doc-section level-3"><h4 id=_события><a class=link href=#_события>События</a></h4><p><strong>События</strong> обозначаются обычной линией с кругом в начале и стрелкой на конце.
Стрелка направлена от внешней системы или ресурса-источника к операции и сопровождается описанием в формате C5.</p><p>В промежуточной версии диаграммы изображение внешней системы можно опустить:</p><div class=image-block><img src=event-operation.png alt="event operation"></div></section><section class="doc-section level-3"><h4 id=_описания><a class=link href=#_описания>Описания</a></h4><p>Для блоков операций можно указать тип, способ реализации и описание:</p><div class=image-block><img src=descriptions.png alt=descriptions></div></section><section class="doc-section level-3"><h4 id=_границы_контейнера_и_внешние_системы><a class=link href=#_границы_контейнера_и_внешние_системы>Границы контейнера и внешние системы</a></h4><p>Элементы, обозначающие границы системы и внешние системы, полностью соответствуют нотации C4:</p><div class=ulist><ul><li>границы системы обозначаются прямоугольником с указанием имени контейнера, для контура прямоугольника используется светло-серая прерывистая линия;</li><li>управляемые внешние системы и базы данных обозначаются прямоугольником и символом «База данных»;</li><li>неуправляемые внешние системы и компоненты обозначаются прямоугольниками светло-серого цвета;</li><li>неуправляемые базы данных обозначаются светло-серым символом «База данных».</li></ul></div></section><section class="doc-section level-3"><h4 id=_связь_внешних_систем_с_другими_элементами_диаграммы><a class=link href=#_связь_внешних_систем_с_другими_элементами_диаграммы>Связь внешних систем с другими элементами диаграммы</a></h4><p>Внешние системы связываются с <strong>операциями</strong> посредством <strong>событий</strong>:</p><div class=image-block><img src=event-sources.png alt="event sources"></div><p><strong>Ресурсы</strong> связываются с внешними системами посредством <strong>стрелок с описанием</strong>:</p><div class=image-block><img src=resource-impls.png alt="resource impls"></div></section><section class="doc-section level-3"><h4 id=_связь_ресурсов_со_сторонними_компонентами><a class=link href=#_связь_ресурсов_со_сторонними_компонентами>Связь ресурсов со сторонними компонентами</a></h4><p><strong>Ресурс</strong> может быть связан со сторонним компонентом, работающим в том же процессе.</p><p>(<mark>todo: заменить стрелку на чёрную</mark>)</p><div class=image-block><img src=resource-component.png alt="resource component"></div></section></section></section><section class="doc-section level-1"><h2 id=_приложение_1_инструментарий><a class=link href=#_приложение_1_инструментарий>Приложение 1. Инструментарий</a></h2><p>Диаграмма эффектов основана на визуальном языке модели C4, поэтому для её построения можно использовать <a href=https://c4model.com/#Tooling>любой инструмент с поддержкой C4</a>.</p></section><section class="doc-section level-1"><h2 id=_приложение_2_реализация_концептуальной_модели_в_коде><a class=link href=#_приложение_2_реализация_концептуальной_модели_в_коде>Приложение 2. Реализация концептуальной модели в коде</a></h2><p>Все элементы, описанные в концептуальной модели, транслируются непосредственно в код: события и операции — в методы, ресурсы — в классы, эффекты — в вызовы методов.</p><p><strong>Операции</strong> всегда транслируются в методы классов (слой сервисов приложения), т.е. в методы, определяющие публичный интерфейс системы.
При реализации этих методов желательно сохранить взаимосвязь эффектов и операций, представленную на диаграмме: методы должны содержать в себе столько же вызовов методов классов-ресурсов, сколько стрелок у соответствующей операции на диаграмме.</p><p><strong>Ресурсы</strong> превращаются в структуру данных и коллекцию методов работы с ней. Это могут быть классы Spring Data агрегата и репозитория, классы события и интерфейса ApplicationEventPublisher (или обёртки вокруг него), классы REST API модели и клиента и т.п.</p><p>В контексте бэкендов информационных систем самыми распространёнными видами ресурсов являются:</p><div class=ulist><ul><li>любые постоянные коллекции данных — таблицы в реляционной СУБД, коллекции в документной СУБД и т.д.;</li><li>REST API внешних сервисов;</li><li>любые очереди сообщений и шины событий;</li><li>изменяемые структуры данных, доступные через глобальные переменные.</li></ul></div><p><strong>События</strong> превращаются в методы, передаваемые фреймворку для последующего вызова. Например, в метод класса контроллера (RestController в Spring), слушателю (EventListener в Swing), в реализацию Runnable для таймера и т.д.</p><p>В контексте бэкендов информационных систем самыми распространёнными видами событий являются:</p><div class=ulist><ul><li>получение запроса по сети (@RestController + @*Mapping в случае разработки на Spring).
Сейчас популярностью пользуется протокол запросов в REST-стиле, но SOAP, gRPC, CORBA и т.п. также попадают в эту категорию;</li><li>появление сообщения в очереди (@JmsListener);</li><li>доменное событие или событие приложения (@EventListener);</li><li>наступление определённого момента времени (@Scheduled). Два основных типа таких событий:<ul><li>наступление заранее известного момента времени (например, полночь вторника);</li><li>истечение определённого времени с момента в прошлом (например, истечение суток с момента создания предыдущего бэкапа).</li></ul></li></ul></div></section></article></section></div></main><script src=/js/app.js></script></body></html>