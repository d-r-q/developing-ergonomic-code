<!doctype html><html lang=en-en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Aleksey Zhidkov"><meta name=description content="https://azhidkov.pro/"><meta property="og:site_name" content="Aleksey Zhidkov"><meta property="og:title" content="Uncle Bob Isn't Always Right - Aleksey Zhidkov"><meta property="og:description" content="A classic implementation of OCP can lead to SRP violations and increase the risk of regressions."><meta property="og:type" content="website"><meta property="og:url" content="https://azhidkov.pro/en/posts/21/04/srp-ocp-conflict/"><meta property="og:image" content="https://azhidkov.pro/"><meta name=twitter:card content="summary"><meta name=twitter:site content="https://azhidkov.pro/en/posts/21/04/srp-ocp-conflict/"><meta name=twitter:image content="https://azhidkov.pro/"><base href=https://azhidkov.pro/en/posts/21/04/srp-ocp-conflict/><title>Uncle Bob Isn't Always Right - Aleksey Zhidkov</title><link rel=canonical href=https://azhidkov.pro/en/posts/21/04/srp-ocp-conflict/><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700"><link rel=stylesheet href=/css/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css><link rel=stylesheet href=https://azhidkov.pro/css/custom.css><link rel=stylesheet href=https://azhidkov.pro/css/github.css><link rel=stylesheet href=https://azhidkov.pro/css/JetBrains-Mono.css><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=alternate href=https://azhidkov.pro/en/index.xml type=application/rss+xml title="Aleksey Zhidkov"><link href=https://azhidkov.pro/en/index.xml rel=feed type=application/rss+xml title="Aleksey Zhidkov"><meta name=generator content="Hugo 0.80.0"></head><body><main class=wrapper><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://azhidkov.pro/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://azhidkov.pro/favicon-16x16.png><link rel=manifest href=site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet type=text/css><nav class=navigation><section class=container style=height:100%><img src=https://azhidkov.pro/images/logo.svg class=logo>
<a class=navigation-title href=/en/>Aleksey Zhidkov</a>
<input type=checkbox id=menu-control>
<label class="menu-mobile float-right" for=menu-control><span class="btn-mobile float-right">&#9776;</span><ul class=navigation-list><li class=mobile-menu-lang-separator-full><hr></li></ul></label></section></nav><div class=content><section class="container post"><article><header><h1 class=title>Uncle Bob Isn't Always Right</h1><h2 class=date>April 28, 2021</h2></header><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>You can follow the blog’s updates in my channel: <a href=https://t.me/ergonomic_code>Ergonomic code (rus)</a></p></aside><section class="doc-section level-1"><h2 id=_uncle_bobs_latest_article>Uncle Bob’s Latest Article</h2><p>I’ve just read <a href=https://blog.cleancoder.com/uncle-bob/2021/03/06/ifElseSwitch.html>Uncle Bob’s recent
article</a> and must say I disagree.</p><p>Here’s a brief overview of the contents.</p><div class="olist arabic"><ol class=arabic><li><p>Someone on the internet asked how’d one go about refactoring this code.</p><div class=image-block><img src=/posts/21/04/srp-ocp-conflict-197cb.png alt="srp ocp conflict 197cb"></div></li><li><p>Uncle Bob said that the right way would be to encapsulate this 'if' statement in a factory object.</p><div class=image-block><img src=/posts/21/04/srp-ocp-conflict-f5d0e.png alt="srp ocp conflict f5d0e"></div></li></ol></div><p>He followed with:</p><div class=quote-block><blockquote><p>Every business rule that would once have depended on an if/else/switch statement now has its own particular method to call in the base class</p><footer>— <cite>Uncle Bob, https://blog.cleancoder.com/uncle-bob/2021/03/06/ifElseSwitch.html</cite></footer></blockquote></div><p>Usually, this would make for either a good design or at least a sensible compromise,
although it still shouldn’t be your no-brainer solution.
In this particular case, though, it’s neither of the two.</p><p>I see two main problems with this design for the original task dealing with genders.</p><div class="olist arabic"><ol class=arabic><li>It’ll cause SRP violations.</li><li>It’ll cause regressions.</li></ol></div><p>Let’s take a deeper look.
We’ll start with SRP.</p></section><section class="doc-section level-1"><h2 id=_god_objects>God Objects</h2><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>Here goes a bit of speculation.</p><p>In his blog post, Uncle Bob drafted an abstract scheme that leaves his readers with no other choice but to speculate.</p><p>So I’m going to proceed with the assumption that in the second picture:</p><div class="olist arabic"><ol class=arabic><li>BaseClass means Gender,</li><li>LLA means Male,</li><li>LLB means Female, and</li><li>LLC means Unknown.</li></ol></div></aside><p>It’s quite easy to imagine some software using gender data to:</p><div class="olist arabic"><ol class=arabic><li>generate an avatar in the UI, or</li><li>top up the budget accounting for a woman’s possible maternity leave.</li></ol></div><p>You’d have to include both these methods in the Gender class.
This would be a SRP violation, no matter how you’d define it.</p><p>If you’ve read the full article, you must’ve noticed the Acyclic Visitor Pattern being talked about in the last sentence.
It’s supposed to solve the problem of having to re-compile the Gender clients.
It can also fix SRP violations.
In this case, you’d have to create an interface with three implementations for each rule.
In case a new gender appears, you’ll also have to make a new implementation for each interface.</p><p>Yet again, I can only speculate here.
Judging by Uncle Bob’s idea to add new methods to the base class, we’re talking about an <a href=https://martinfowler.com/ieeeSoftware/published.pdf>unpublished</a> class.</p><p>If that’s true, barely anyone would waste this much time fiddling with the visitor.
Even if they had, they’d realize, after writing a few dozen classes, that the visitor’s cost is
inadequate for the job.
That’s great if they think that, even, instead of just jumbling everything into one class.
We’ll get back to this later, though.</p></section><section class="doc-section level-1"><h2 id=_quantum_entanglement>Quantum entanglement</h2><p>The second problem is caused by the cohesive logic being scattered through space, or at least among
multiple classes.</p><p>Maybe across all the packages and modules, even. Uncle Bob says nothing about
imposing any limitations on the gender hierarchy.</p><p>While criticizing the 'if’s-based option, Uncle Bob says:</p><div class=quote-block><blockquote><p>The fact that they are replicated in many places is problematic because when such statements are inevitably changed, it is easy to miss some.
This leads to fragile systems.</p><footer>— <cite>Uncle Bob</cite></footer></blockquote></div><p>He’s approaching this in the exact same way, though, albeit at a different angle!</p><p>The root of all code analysis problems lies here as well.
While you’ll be trying to understand how the avatar generation works, you’ll have to be switching back and
forth between three files.</p></section><section class="doc-section level-1"><h2 id=_are_there_any_alternatives_though>Are there any alternatives, though?</h2><p>Fifteen years ago I would, with no doubts, suggest using algebraic data types.
It’s easy to assume there’ll be a lot of new operations here, yet barely any new options.</p><p>Today, I’d have my doubts but would still stick with ADT.
I can imagine a new gender appearing, but only in theory for now.
You can be sure you’ll need new operations, though.</p><p>With modern programming languages (and even Java, <a href=https://openjdk.java.net/jeps/397>at least
almost</a>), in case of ADT, compilers are at best as secure during compilation as interfaces.
With a new type added, the program won’t compile until all the ifs and switches get it
processed.</p><p>Speaking about dependencies' directions, HighLevel can depend on both an abstract and a
concrete function alike:</p><div class=listing-block><pre class="rouge highlight"><code data-lang=kotlin><span class=kd>class</span> <span class=nc>UI</span><span class=p>(</span><span class=k>private</span> <span class=kd>val</span> <span class=py>generateAvatar</span><span class=p>:</span> <span class=p>(</span><span class=nc>Gender</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=nc>Image</span><span class=p>)</span></code></pre></div><p>If you want, you can also wrap it in <code>IAvatarGenerator</code> and implement in <code>AvatarGeneratorImpl</code>.</p><p>Main thing is that in this case, the avatar generation method stays in the UI, while the budget
calculation method stays in the services layer.
What’s more, you’d be able to fit their code in just one screen.</p></section></article><br></section></div></main><script src=/js/app.js></script></body></html>