<!doctype html><html lang=ru-ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Алексей Жидков"><meta name=description content="https://azhidkov.pro/"><meta property="og:site_name" content="Алексей Жидков"><meta property="og:title" content="Эргономичный подход v1.0M1 - Алексей Жидков"><meta property="og:description" content="Или как создавать программы, которые всем стейкхолдерам приносят больше положительных эмоций"><meta property="og:type" content="website"><meta property="og:url" content="https://azhidkov.pro/posts/22/04/220409-ergo-approach-v10m1/"><meta property="og:image" content="https://azhidkov.pro/"><meta name=twitter:card content="summary"><meta name=twitter:site content="https://azhidkov.pro/posts/22/04/220409-ergo-approach-v10m1/"><meta name=twitter:image content="https://azhidkov.pro/"><base href=https://azhidkov.pro/posts/22/04/220409-ergo-approach-v10m1/><title>Эргономичный подход v1.0M1 - Алексей Жидков</title><link rel=canonical href=https://azhidkov.pro/posts/22/04/220409-ergo-approach-v10m1/><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700"><link rel=stylesheet href=/css/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css><link rel=stylesheet href=https://azhidkov.pro/css/custom.css><link rel=stylesheet href=https://azhidkov.pro/css/github.css><link rel=stylesheet href=https://azhidkov.pro/css/JetBrains-Mono.css><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=alternate href=https://azhidkov.pro/index.xml type=application/rss+xml title="Алексей Жидков"><link href=https://azhidkov.pro/index.xml rel=feed type=application/rss+xml title="Алексей Жидков"><meta name=generator content="Hugo 0.80.0"></head><body><main class=wrapper><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://azhidkov.pro/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://azhidkov.pro/favicon-16x16.png><link rel=manifest href=site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet type=text/css><nav class=navigation><section class=container style=height:100%><img src=https://azhidkov.pro/images/logo.svg class=logo>
<a class=navigation-title href=/>Алексей Жидков</a>
<input type=checkbox id=menu-control>
<label class="menu-mobile float-right" for=menu-control><span class="btn-mobile float-right">&#9776;</span><ul class=navigation-list><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/book/ergo>Книга</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/posts>Блог</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/portfolio>Портфолио</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/>Контакты</a></li><li class=mobile-menu-lang-separator-full><hr></li><li class=multilingual-separator><p>|</p></li><li class="navigation-item align-left"><a href=https://azhidkov.pro/en/>En</a></li></ul></label></section></nav><div class=content><section class="container post"><article><header><h1 class=title>Эргономичный подход v1.0M1</h1><h2 class=date>April 9, 2022</h2></header><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>Следить за обновлениями блога можно в моём канале: <a href=https://t.me/ergonomic_code>Эргономичный код</a></p></aside><section class="doc-section level-1"><h2 id=_предисловие><a class=link href=#_предисловие>Предисловие</a></h2><p>Я рад сообщить о завершении этапа прототипирования и проверки гипотезы Эргономичного подхода и переходе к стабилизации и продуктизации.</p><p>Работу над Эргономичным подходом я начал весной 2020 года.
Причиной тому стал возврат к работе над стандартными для экосистемы Spring-а проектами после четырёхлетнего перерыва.</p><p>На контрасте с работой над своими проектами, я особенно остро ощутил уже забытые чувства раздражения от избыточной трудоёмкости решения задач и страха внести регрессию.
Уже тогда я понимал, что причины и того и другого кроются во многих широко распространённых практиках - пакетировании по слоям, <a href=https://ru.wikipedia.org/wiki/%D0%A1%D0%B2%D1%8F%D0%B7%D0%BD%D1%8B%D0%B9_%D0%B3%D1%80%D0%B0%D1%84>связном граф</a> анемичных JPA-сущностей, глобальном компонент скане, тестах на моках.
В своих проектах я делал это как-то по-другому, но именно "как-то" - каждый раз уникальным образом на основе интуиции.</p><p>Для того чтобы вытащить эту интуицию наружу и сначала систематизировать собственную работу, а потом научить других делать так же и систематизировать работу команды, я начал писать книгу.
Всё началось с этого наброска:</p><div class=image-block><img src=/posts/22/04/images/ergo-approach-first-sketch.JPG alt="ergo approach first sketch"></div><p>На удивление эта диаграмма с точностью до терминов всё ещё актуальна на 100%.
Но она стала лишь частью одного из трёх столпов Эргономичного подхода - декларативного стиля (два других - концептуальная декомпозиция и тестирование требований).</p><p>Главным пробелом в системе моей работы была декомпозиция кода на модули.
В первом описании <a href=https://azhidkov.pro/book/ergo/#_мой_подход_к_разбиению_классов>подхода к декомпозиции</a> у меня классы сами разбивались на кластеры, а если нет, то "надо смотреть каждый конкретный случай и универсального рецепта у меня нет".</p><p>Поэтому главное, что я сделал за эти два года - нашёл практический ответ на вопрос "Если не на слои, то как по другому декомпозировать систему?".
Я считаю именно это главной ценностью Эргономичного подхода, альтернативы которой нет ни в одном другом источнике, включая DDD, Чистую Архитектуру, работы Парнаса и ещё пяток книг по проектированию приложений.</p><p>И хотя работа ещё не окончена, я уже сейчас хочу выразить благодарность руководителям в ряде компаний:</p><div class="olist arabic"><ol class=arabic><li>Кожевникову Максиму - Трейдинг Клаб Раша</li><li>Макарову Николаю - Брума Сервис</li><li>Кармакову Владу, Степанову Владимиру и Бурмину Леониду - Сибериан.про</li><li>Валиеву Олегу и Тимофееву Евгению - БрендМейкер-ру</li></ol></div><p>Я бы не довёл Эргономичный подход даже до текущего состояния, если бы они не поверили в мой профессионализм и не дали мне возможности делать проекты так, как я считаю правильным.</p><p>Со всеми этими компаниями я сделал больше одного проекта, представители трёх из них подписаны на мой канал, а в одной из них я отвечаю за направление разработки под JVM - на мой взгляд, всё это говорит о хороших для бизнеса результатах работы по Эргономичному подходу.</p><p>Если вы тоже хотите, чтобы ваши программы приносили больше положительных чувств всем стейкхолдерам от разработчиков до учредителей - присоединяйтесь к бета-тестированию Эргономичного подхода.
Для этого напишите мне:</p><div class="olist arabic"><ol class=arabic><li>Telegram: <a href=https://t.me/d_r_q>d-r-q</a></li><li>Email: <a href=mailto:me@azhidkov.pro>me@azhidkov.pro</a></li><li>VK: <a class=bare href=https://vk.com/d_r_q>https://vk.com/d_r_q</a></li></ol></div><p>Я могу предложить широкий спектр вариантов сотрудничества - от разовых консультаций до реализации проектов под ключ.</p><p>Также хочу поблагодарить читателей моего <a href=https://t.me/ergonomic_code>канала</a> - небольшой, но стабильный и естественный прирост количества подписчиков значит для меня, что моя работа нужна людям и это даёт мне дополнительную мотивацию продолжать её.</p><p>А теперь собственно представляю вам верхнеуровневое описание методики разработки информационных систем "Эргономичный подход" версии 1.0 milestone 1.</p></section><section class="doc-section level-1"><h2 id=_эргономичный_подход_v1_0m1><a class=link href=#_эргономичный_подход_v1_0m1>Эргономичный подход v1.0M1</a></h2><section class="doc-section level-2"><h3 id=_мотивация><a class=link href=#_мотивация>Мотивация</a></h3><p>Люди ещё в 70ых годах выяснили, что основным источником проблем (и как следствие увеличения стоимости) в развитии программ является сцепленность (coupling).
Тем не менее сейчас в мейнстримном подходе к разработке существует множество практик, которые упрощают решение задачи в моменте за счёт увеличения сцепленности системы.
Такие практики я называю тактическим программированием.
Следствием тактического программирования являются избыточная трудоёмкость внесения изменений в систему, сопряжённая с большим количеством регрессий.
Что, в свою очередь, ведёт к увеличению итоговой стоимости разработки.</p><p>Для того чтобы свести к минимуму количество проблем в своих проектах (а заодно и их стоимость для заказчиков), я нашёл альтернативные практики, которые минимизируют сцепленность системы.
И хотя сведение сцепленности к минимуму часто требует дополнительных усилий по проектированию и кодированию, взамен оно решает описанные выше проблемы и уменьшает итоговую стоимость разработки.</p><p>Объединив и подогнав друг к другу эти практики, я получил стратегическую методику разработки програм - Эргономичный подход.</p><p>У меня (<a href=https://www.amazon.com/Philosophy-Software-Design-John-Ousterhout/dp/1732102201>и не только</a>) есть эмпирическое ощущение, что инвестиции в дизайн начинают окупаться уже через два-три месяца от старта проекта.
А спустя примерно шесть месяцев "стратегические проекты" уверенно обгоняют "тактические проекты" по количеству реализованной функциональности.</p></section><section class="doc-section level-2"><h3 id=_основные_отличия_от_мейнстримного_подхода><a class=link href=#_основные_отличия_от_мейнстримного_подхода>Основные отличия от мейнстримного подхода</a></h3><p>Большая часть практик Эргономичного подхода давно известна и продвигается многими известными инженерами и учёными:</p><div class="olist arabic"><ol class=arabic><li>Для моделирования информации в ЭП используются <a href=https://azhidkov.pro/posts/22/04/220401-aggregates/>агрегаты из DDD</a>, вместо связного графа объектов</li><li>ЭП предполагает <a href=https://dev.to/tomekbuszewski/relational-and-immutable-models-as-persistence-layer-3j9j>неизменяемую модель данных</a> и <a href=https://donnywinston.com/posts/the-materials-paradigm-and-epochal-time>эпохальную модель времени</a> из ФП, вместо императивной изменяемой модели</li><li>ЭП предполагает фокус на <a href=https://azhidkov.pro/posts/21/01/210112-pure-functions/>чистых функциях</a> из ФП, вместо повсеместного императивного программирования</li><li>Как следствие первых трёх пунктов - ЭП требует использования <a href=https://azhidkov.pro/posts/21/04/why-jpa-should-be-avoided/>Spring Data JDBC, вместо Spring Data JPA</a></li><li>В рамках ЭП выполняется <a href=https://azhidkov.pro/posts/21/03/250326-project-decomposiotion/>функциональная декомпозиция</a> из Чистой архитектуры и DDD, вместо механической декомпозиции по техническим аспектам кода</li><li>ЭП предполагает тестирование сценариев использования из классического подхода Бека, вместо тестирования отдельных классов и методов</li><li>В рамках ЭП выполняется <a href=https://azhidkov.pro/posts/21/03/210321-project-l-testing/>тестирование модулей</a> в конфигурации, приближенной к боевой из классического подхода, вместо мокирования всех зависимостей</li><li>ЭП <a href=https://azhidkov.pro/posts/21/10/211018-ergo-approach-post/#_структура_реализации_операции_системы>разделяет код на чистое ядро и императивную оболочку</a> из ФП (и ДДД, и Чистой архитектуры), вместо разделения кода на слои представления, бизнес-логики и данных</li><li>ЭП предполагает "крафтовое" управление зависимостями, вместо использования неуправляемого глобального Spring Component Scan</li><li>В рамках ЭП выполняется "крафтовая" настройка инфраструктуры, вместо неуправляемого глобального сканироваия Spring Auto Configuraions</li></ol></div><p>Многие из этих пунктов подробнее раскрыты в посте <a href=https://azhidkov.pro/posts/21/11/211107-what-is-the-difference/>"Что я делаю не так"</a>.</p><p>Рассмотрим саму методику.</p></section><section class="doc-section level-2"><h3 id=_методика><a class=link href=#_методика>Методика</a></h3><p>Глобально разработка по Эргономичному подходу состоит из привычных этапов - системная аналитика, проектирование и реализация.</p><section class="doc-section level-3"><h4 id=_системная_аналитика><a class=link href=#_системная_аналитика>Системная аналитика</a></h4><p>Выполнять системную аналитику проще всего на основе сценариев использования и мокапов UI.
Но эти артефакты создаются далеко не всегда, поэтому требования зачастую приходится выуживать из заказчика или эксперта напрямую.</p><p>На этапе системной аналитики строится ER-диаграмма модели информации системы, определяется список необходимых интеграций и проектируется API системы.
Все три этих артефакта сильно связаны между собой и создаются параллельно в процессе разбора и проработки требований.
Сейчас API системы, как правило, выполняется в REST-стиле.</p><p>После этого создаётся <a href=https://azhidkov.pro/posts/22/05/220519-effects-diagram-intro/>диаграмма эффектов</a>.
Диаграмма эффектов - это моё изобретение, которое объединяет в себе информацию из предыдущих трёх артефактов и является исходным материалом для этапа проектирования.</p><p>Построение диаграммы эффектов начинается с того, что на неё помещаются все методы API в качестве операций системы, а все множества сущностей и интеграции - в качестве ресурсов.
Затем для каждой операции определяются события, её инициирующие, после чего определяются и обозначаются связи между событиями, операциями и требуемыми для них ресурсами.</p><p>Гранулярность отдельных сущностей является слишком мелкой и работать с ними несподручно, поэтому после построения диаграммы эффектов необходимо объединить их в агрегаты и по мере обнаружения агрегатов заменить ресурсы кластеров соответствующих сущностей на ресурс агрегата.</p><p>Закончив диаграмму эффектов, можно переходить к этапу проектирования модулей системы.</p></section><section class="doc-section level-3"><h4 id=_проектирование><a class=link href=#_проектирование>Проектирование</a></h4><p>Этап проектирования начинается с того, что диаграмма эффектов декомпозируется на модули таким образом чтобы:</p><div class="olist arabic"><ol class=arabic><li>инкапсулировать модификации ресурсов в одном модуле</li><li>в целом минимизировать любые обращения операций к ресурсам других модулей</li></ol></div><p>Построив первую декомпозицию на базе эффектов, надо без фанатизма попытаться построить <a href=http://jodypaul.com/SWE/HAL/hal.html>список сокрытия предположений</a> из декомпозиции по Парнасу.
Если в результате находится что-то существенное - вынести это в отдельный модуль и отразить его на диаграмме модулей.</p><p>После этого получившуюся декомпозицию необходимо проверить на предмет соответствия принципам:</p><div class="olist arabic"><ol class=arabic><li><a href=https://en.wikipedia.org/wiki/Acyclic_dependencies_principle>Ацикличных зависимостей</a></li><li><a href=https://enterprisecraftsmanship.com/posts/cohesion-coupling-difference>Высокой функциональной связанности, низкой сцепленности</a></li><li>Стабильности зависимостей</li><li><a href=https://azhidkov.pro/posts/21/06/210626-srp-interpretations/>Единственности ответственности</a></li></ol></div><p>Затем необходимо определить и скрыть подмодули.
Модуль является подмодулем если он:</p><div class="olist arabic"><ol class=arabic><li>Используется только одним модулем</li><li>Теряет всякий смысл при удалении этого модуля</li></ol></div><p>Получив "достаточно хорошую" декомпозицию, можно переходить к этапу реализации.</p></section><section class="doc-section level-3"><h4 id=_реализация><a class=link href=#_реализация>Реализация</a></h4><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>Сейчас я обкатываю Эргономичный подход в проектах на базе Spring Framework, но я уверен, что его можно успешно применить и к проектам на других технологиях.</p></aside><p>Реализацию необходимо начинать с того, чтобы создать по пакету для каждого модуля, а в пакете как минимум классы Spring конфигурации и сервиса без реализации.</p><p>Следующим шагом необходимо написать тест на сценарий использования, выбранный для реализации в данный момент.
Сценарный тест - это тест, который работает через <a href=http://xunitpatterns.com/Principles%20of%20Test%20Automation.html>внешний интерфейс</a> системы (HTTP, как правило) и симулирует работу клиента.
На данном этапе, естественно, тест не проходит.</p><p>Если реализуется первый сценарий использования системы, то необходимо создать точку входа - класс с методом main и корневой Spring конфигурацией.
При этом необходимо воздержаться от использования глобального Spring Component Scan и AutoConfiguration - приложение "собирается" посредством импорта конфигураций всех модулей в корневой конфигурации приложения.
Если модулям нужна инфраструктура (например, подключение к БД) - для этого создаются отдельные конфигурации.
Затем эти конфигурации импортируются только в те модули, которым они требуются.</p><p>После этого можно переходить к непосредственно реализации операций системы, задействованных в непроходящем на данный момент тесте.
Для этого, как правило, надо реализовать два класса ресурса - отдельные элементы (сущности, DTO, события и т.п.) и их коллекции (репозитории, REST-клиенты, топики в очередях событий).
Эти классы лучше делать internal/package private.
Но если отдельные элементы надо выдавать наружу как есть, нет ничего страшного в том, чтобы выставить их в публичный интерфейс модуля.</p><p>В реализации операций необходимо придерживаться <a href=https://azhidkov.pro/posts/21/10/211018-ergo-approach-post/#_структура_реализации_операции_системы>структуры ориентированной на трансформации</a> и <a href="https://www.youtube.com/watch?v=yTkzNHF6rMs">функциональной архитектуры</a>.
Из этого следует несколько ограничений:</p><div class="olist arabic"><ol class=arabic><li>Отдельные элементы необходимо реализовывать в виде неизменяемых структур данных</li><li>Коллекции элементов необходимо реализовывать декларативно или максимально прямолинейно, идеальная коллекция элементов - интерфейс Spring Data репозитория</li><li>В классе сервиса остаётся только верхнеуровневое управление потоком данных</li><li>Преобразования (если они есть) необходимо выносить либо в классы отдельных элементов, либо в чистые функции ядра</li></ol></div><p>После того как сценарный тест прошёл, необходимо прислушаться к себе - достаточно ли сценарного теста, для того чтобы спокойно зарелизать сценарий в прод?
Если недостаточно - дополнить тестовый набор.
Дополнять можно компонентными и юнит-тестами.
Предпочтение лучше отдавать компонентным тестам, переходя к юнит-тестам в случае, если, по вашему мнению, повышение сцепленности тестов нивелируется высокой скоростью их написания и выполнения, а также стабильностью и процентом покрытия.
При этом использование моков классов в любом виде тестов не допускается.</p><p>При наличии возможности, внешние системы также лучше использовать полнофункциональные.
Мокирование внешней системы допускается, если нет принципиальной возможности её использования или же использование в тестировании влечёт существенные прямые расходы (платное АПИ) или нестабильность тестов.
При этом лучше отдавать предпочтение механизмам мокирования на уровне процессов, таких как <a href=https://wiremock.org/>WireMock</a>.</p><p>Получив достаточную степень уверенности, можно отдавать код на ревью и, вмёржив его, переходить к реализации следующего сценария.</p></section></section></section><section class="doc-section level-1"><h2 id=_заключение><a class=link href=#_заключение>Заключение</a></h2><p>Реализовав все сценарии таким образом, вы получите систему с надёжным покрытием тестами и низкой сцепленностью.
Это существенно сократит итоговую стоимость реализации системы и количество отрицательных эмоций у разработчиков, пользователей и заказчиков.</p><p>Если вы готовы внедрить Эргономичный подход у себя в компании или проекте, напишите мне:</p><div class="olist arabic"><ol class=arabic><li>Telegram: <a href=https://t.me/d_r_q>d-r-q</a></li><li>Email: <a href=mailto:me@azhidkov.pro>me@azhidkov.pro</a></li><li>VK: <a class=bare href=https://vk.com/d_r_q>https://vk.com/d_r_q</a></li></ol></div><p>И мы обязательно найдём взаимовыгодный способ сотрудничества.</p></section></article><br></section></div></main><script src=/js/app.js></script></body></html>