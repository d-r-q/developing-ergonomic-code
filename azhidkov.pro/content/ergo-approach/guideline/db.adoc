---
title: "Работа с БД"
date: 2022-12-10T01:25:37+07:00
draft: false
---

:icons: font
:source-highlighter: rouge
:rouge-theme: github
:icons: font
:sectlinks:

[NOTE]
====
Работа над гайдлайном находится в процессе.
====

## Миграция схемы

[NOTE]
====
В этом документе подразумевается использование https://flywaydb.org/[Flyway] для миграции схемы.
====


### Изменение файлов миграций, вмёрженных в мастер запрещено

Это приведёт к отказу приложения при запуске.
Вместо изменения существующих файлов необходимо создать новый файл с DDL нужных модификаций схемы БД.

### Миграции объектов без состояний

Представления, правила, хранимые процедуры и т.д. должны выполняться с помощью https://documentation.red-gate.com/fd/migrations-184127470.html#Migrations-RepeatableMigrations[repeatable migrations].

## Ссылочные данные

### Массовая вставка

Массовая вставка в одну таблицу должна выполняться одним запросом со списком значений:

[source,sql]
----
INSERT INTO products (food_id, food_name, created_at, owner_id, deleted, version)
VALUES ('393de5ca-b74d-48cc-acef-1fc5d2952cbd', 'Белый хлеб', '2023-10-20 07:41:09.093052', null, false, 1),
       ('d8ff3f53-57d0-4550-8479-e3b8de79094c', 'Черный хлеб', '2023-10-20 07:41:09.093052', null, false, 1);
----
